<style>

/* Fix the tax table header */
thead th { position: sticky; top: 0; }
#gnom-table td a{
   text-decoration: none;
}
#gnom-table th{
   border-right:1px solid ivory;
}

/* Tools Menu  */
.dropbtn {
  background-color: #04AA6D;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  z-index: -1;
}

/* The container <div> - needed to position the dropdown content */
.dd-menu {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background:lightblue;
  width:165px;  /* This sets the box width to allow cursor contact */
  padding:8px;
  margin:0px;
  border:1px solid black;
  left:-160px;
  top:-50px;
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  font-size:13px;
  margin:5px 0;
  display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {
    background-color: white;
    border:1px solid tomato;
    color:black;
    
}

/* Show the dropdown menu on hover */
.dd-menu:hover .dropdown-content {display: block;}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dd-menu:hover .dropbtn {background-color: #3e8e41;}
#loader {
    background: url('/images/loading.gif') no-repeat center center;
    position: absolute;
    background-size: 100px 100px;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    z-index: 9999999;
}
</style>
<link rel="stylesheet" type="text/css" href="/css/genome_pages.css" >

<%- include('../../partials/header_html'); %>
<% ginfo = JSON.parse(data) %>
<% fltr = JSON.parse(filter) %>
<% phyla = JSON.parse(phyla) %>
<% pgdata = JSON.parse(pd) %>
<% filtergid = fltr.gid %>
<% var cfg = JSON.parse(config) %> 
<% no_ncbi_annotation = JSON.parse(no_ncbi_annot) %>

<%= cfg.JBROWSE_URL %>


<body>
 <div id="loader" class="center-loader" style='z-index:1'></div>

  <div id='wrapper'>
    <%- include('../../partials/header_img'); %>
    <%- include('../../partials/navbar'); %>
  <div  class='page-content' >
  <p class='h3 title'><%= pgtitle %></p>

<span><small>There are <%= gcount %> genomes representing <%= tcount %> taxa (Including 'Reference' and 'Dropped' Taxa).</small></span>


<div class='download_browser_text_excel'><b>Download this Genome Data</b>: 
       <a href='/download/dld_genome_table/browser' >[Browser]</a>
       <a href='/download/dld_genome_table/text' >[Text]</a>
       <a href='/download/dld_genome_table/excel' >[Excel]</a>
       <b>OR</b> <a href='/download/download/genome'>Batch Genomic Data</a>
</div> 

 <%- include("../../partials/genome_table_basic_filter.ejs") %> 


<br><%- count_txt %>
<% if(cfg.DBHOST == "localhost"){ %>
<br><span style=''><small><b>Localhost</b>
  Available V11.0-PROKKA Annos: GCA_000174175.1, GCA_016648925.1, GCA_030450175.1, GCA_900105505.1, GCA_938028245.1
  <br>Phage: GCA_000008065.1, GCA_000007645.1, GCA_000008345.1

</small></span>
<% } %>

  
<div id='genome-box'>
    <table id='gnom-table' class='table table-hover table-condensed' style='background: lightgrey;'>
    <thead>
    <tr><th class='col0' >row #</th>
    <th class='col1' scope='col' >Genome-ID</th>
    <th class='col2' scope='col' nowrap>Taxon-ID</th>
    <th class='col3' scope='col' >Species</th>
    <th class='col4' scope='col' >Strain</th>
    <th class='col5' scope='col' >MAG</th>
    <th class='col6' title='Assembly Level' scope='col' >Assembly<br>Level</th>
    <th class='col7' scope='col' ><small>Contigs</small></th>
    <th class='col8' scope='col' >Combined<br>Length</th>
    <th class='col9' scope='col' >GC(%)</th>
    <th class="col10 sorttable_nosort" scope='col' >More Information, Tools<br> and Annotations</th>
    
    </tr>
    </thead>
    
    <% if(ginfo.length === 0){ %>
       <tr><td>None Found</td></tr>
    <% }else{ %>
    
    <tbody>
    <% rowcount = pgdata.start_count %>
    
    <% for(n in ginfo){ %>
      
      <% taxidfullname = "HMT-"+("000" + ginfo[n].otid).slice(-3); %>
      <% rowid =  ginfo[n].gid.split('.')[0]; %>
      <tr id='<%= rowid %>' >
         <% if(filter_on == "off"){  %>
            <td class='right'><%= rowcount %></td>
        <% }else{ %>
            <td class='right'><%= parseInt(n) + 1 %></td>
      <% } %>
        <% genus = ginfo[n].organism.split(" ")[0] %>
        <td class='linkout center'><a href="genome_description?gid=<%= ginfo[n].gid %>"> <%= ginfo[n].gid %></a></td>
        <td class='linkout center' nowrap ><a href='/taxa/tax_description?gid=<%= ginfo[n].gid %>&otid=<%= ginfo[n].otid %>'><%= taxidfullname %></a></td>
        <td class='tax_name ellipsis' title='<%= ginfo[n].organism %>'><a href='/taxa/life?rank=genus&name=<%= genus %>&gid=<%= ginfo[n].gid %>'><em><%= ginfo[n].species %> <%= ginfo[n].subspecies %></em></a></td>
        
       
        
        <td class='tax_name ellipsis' title='<%= ginfo[n].strain %>'><em><%= ginfo[n].strain %></em></td>
        <td class='center'><%= ginfo[n].mag %></td>
        <td class='ellipsis'><%= ginfo[n].level %></td>
        <td class='center'><%= ginfo[n].contigs %></td>
        <td class='center' title='Size: <%= ginfo[n].combined_size %>bp'><%= ginfo[n].combined_size %></td>
    
        <td class='center'><%= ginfo[n].gc %></td>
        <% gc2 = (parseFloat(ginfo[n].gc)/100).toFixed(2) %>
        <td class='center' nowrap>
            
            <span class="dd-menu">
                <button class="dropbtn pill pill-indigo">Hover Menu</button>
                <div class="dropdown-content">
                <li><%= ginfo[n].gid %></li>
                <li><a class='pill pill-colorkit1' href='genome_description?gid=<%= ginfo[n].gid %>&otid=<%= ginfo[n].otid %>'>Genome Description</a></li>
                <li><a class='pill pill-colorkit2' href='#' onclick="open_jbrowse('<%= ginfo[n].gid %>','genome_table','<%= ginfo[n].gc %>')">Genome Viewer
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                      </svg>
                </a></li>
                <li><a class='pill pill-colorkit3 icon-link' href='conserved_protein_tree?gid=<%= ginfo[n].gid %>' target='_blank'>Genome Tree
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                      </svg>
                    </a>
                </li>
                
                <li><a class='pill pill-colorkit4' href='/taxa/tax_description?gid=<%= ginfo[n].gid %>&otid=<%= ginfo[n].otid %>'>Taxon Info: <%= taxidfullname %></a></li>
                <li><a class='pill pill-colorkit5' href='/taxa/tax_hierarchy?otid=<%= ginfo[n].otid %>'>Taxon Tree: <%= taxidfullname %></a></li>
                
                <li><a class='pill pill-colorkit6' href='<%= cfg.BLAST_URL_BASE %>/genome_blast_single_prokka/?gid=<%= ginfo[n].gid %>' target="_self">BLAST</a></li> 
                <% if(ginfo[n].phage == 'yes' ){ %>
                    <li><a class='pill pill-colorkit7' href='/phage/phage?gid=<%= ginfo[n].gid %>' target="_self">Phage</a></li>
                <% }else{ %>
                    <li><span class='pill pill-grayed' title='Phage Not Available'>Phage (not available)</span></li>
                <% } %>
                <li>Annotations:</li>
                <a class='pill pill-colorkit8' href='explorer?gid=<%= ginfo[n].gid %>&anno=prokka'>PROKKA</a>
                <% if(no_ncbi_annotation.indexOf(ginfo[n].gid) == -1 ){ %>
                    <li><a class='pill pill-colorkit9' href='explorer?gid=<%= ginfo[n].gid %>&anno=ncbi'>NCBI</a></li>
                <% }else{ %>
                    <li><span class='pill pill-grayed' title='NCBI Annotation Not Available' >NCBI (not available)</span></li>
                <% } %>
                
                </div>
            </span>
        </td>
        
        
      </tr>
      <% rowcount = rowcount + 1 %>
    <% } %>

    </tbody>
    <% } %>
    </table>
</div>  <!-- end genome-box -->
    
  
    </div> <!-- end: page-content -->
    
    <div id='footer'>
         <%- include('../../partials/footer'); %>
    </div>
       
   
  </div> <!-- end wrapper -->
<div class="form-popup" id="myAdvancedForm">
  <%- include("../../partials/genome_table_advanced_filter.ejs") %>
  <!-- include("../../partials/tax_table_advanced_filter.ejs") -->
  <!-- include("../partials/tax_table_TEST_filter.ejs") -->
</div>
</body>

</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>


<script type="text/javascript" src="/js/sorttable.js"></script> <!-- https://www.kryogenix.org/code/browser/sorttable -->
<script type="text/javascript" src="/js/menu.js"></script>
<script type="text/javascript" src="/js/genomes.js"></script>
<script>
    mainmenu()  // function in public/js/menu.js
    
    
    var letter = '<%- fltr.letter %>'
    var gid = '<%- filtergid %>'
    var filter_on = '<%- filter_on %>'
    var jb_path = '<%- cfg.JBROWSE_URL %>'
    if(letter){
      document.getElementById(letter).style.color = 'red'
      document.getElementById(letter).style.fontSize = 'medium'
      document.getElementById(letter).style.textDecoration = 'underline'
    }
    if(filter_on === 'on'){
       document.getElementById('reset').style.color = 'black'
       document.getElementById('reset').style.background = 'orange'
       document.getElementById('reset').style.cursor = 'pointer'
       document.getElementById('reset').style.display = 'block'
       document.getElementById("reset").disabled = false;
    }
    //scrollto
    table = $('gnom-table')
    tableContainer = $('#genome-box')
    //otid = '325'
    if(gid){
        row = $('#'+gid.split('.')[0])  // MUST remove the '.' for id
        // scroll 2 more rows == 41 x2 ==164
        extra = 60
        if(row.length) {
           //console.log(row.offset().top);
           ///console.log(tableContainer.height()/2);
           tableContainer.scrollTop(row.offset().top - (tableContainer.height()/2) - extra)
        }
    }

//console.log('gid',gid)
document.onreadystatechange = function() {
        // just three els to loader: this(js);css;html
        if (document.readyState !== "complete") {
            document.querySelector(
                '#genome-box').style.visibility = "hidden";
            document.querySelector(
                "#loader").style.visibility = "visible";
        } else {
            document.querySelector(
                "#loader").style.display = "none";
            document.querySelector(
                '#genome-box').style.visibility = "visible";
        }
};
function openAdvancedForm() {
    var form = document.getElementById("myAdvancedForm") //.style.display// = "block";
    $(form).fadeIn();
}

function closeAdvancedForm() {
    document.getElementById("myAdvancedForm").style.display = "none";
}
</script>

