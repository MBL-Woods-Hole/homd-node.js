<style>
/* thead th { position: sticky; top: 0; } */
#crispr-table-div{
   
  
}
/* hover Menu  */
.dropbtn {
  background-color: #04AA6D;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  z-index: -1;
}

/* The container <div> - needed to position the dropdown content */
.dd-menu {
  position: relative;
  display: inline-block;
  padding:5px;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background:lightblue;
  width:1300px; 
  /* overflow:auto; */
  
  padding:10px;
  margin:0px;
  border:1px solid black;
  right:80px;
  top:18px;
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  font-size:13px;
  margin:5px 0;
  display: block;
}
/* Change color of dropdown links on hover */
.dropdown-content a:hover {
    background-color: white;
    border:1px solid tomato;
    color:black;
    
}

/* Show the dropdown menu on hover */
.dd-menu:hover .dropdown-content {display: block;}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dd-menu:hover .dropbtn {background-color: #3e8e41;}
.hover-table {
        table-layout: fixed;
        /* width: 180px; */
        width:100%;
        padding: 7px;
        font-size:12px;
        text-decoration: none;
        
        border-radius: 3px;
        color: #555;
        th {
            text-align:center;
        }
        
        td {
          border:1px solid black;
          padding:3px;
          /* max-width: 240px; */ /* Or a specific width like width: 150px; */
          word-break: break-all;
          width: 240px;
          /* overflow: hidden; */
          /* text-overflow: ellipsis; */
          /* white-space: nowrap; */
        }
        
    
}
.col1{
    width:220px;
}
.col1a{
    width:220px;
}
.col3{
    width:120px;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 280px;
}
.col2{
    width:80px;
}
.col9{
    width:40px;
}
.hovercol1{
   width:250px;
}
.hovercol5{
   width:100px;
}
.hovercol6{
   width:80px;
}
.hovercol9{
   width:60px;
}
#loader {
    background: url('/images/loading.gif') no-repeat center center;
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    z-index: 9999999;
}
</style>
<% var cfg = JSON.parse(config) %> 
<% var genomelist = JSON.parse(gid_list) %>
<% var cdata = JSON.parse(crispr_data) %>
<%- include('../../partials/header_html'); %>

<body>
    <div id="loader" class="center-loader" style='z-index:1'></div>
    <div id='wrapper'>
    <%- include('../../partials/header_img'); %>
    <%- include('../../partials/navbar'); %>
    
    
    <div class='page-content' >
              
       <p class='title h3'>CRISPR-Cas systems detected in <%= full_count %> HOMD genomes</p>
       
       
       
       
       
       
       <div id='crispr-table-div'>
       <table id='crispr-table' class='table table-hover table-condensed sortable'>
       <thead>
        <tr>
            <th class='center col1'>Genome-ID</th>
            <th class='center col1'>Taxon-ID</th>
            <th class='col3'>Species</th>
            <th class='col3'>Strain</th>
            <th class='center col1'>Contigs</th>
            <th class='center'>Length<br>(bp)</th>
            <th class='center'>CRISPR-Cas<br>Count</th>
            <th class='center col1 sorttable_nosort'>FTP<br>Directory</th>
            
        </tr>
       </thead>
       <tbody>
       <% for(n in genomelist){ %>
       <% gid = genomelist[n].gid %>
       <% taxidfullname = 'HMT-'+("000" + cdata[gid].otid).slice(-3); %>
       
       <tr>
            <td class='center'><a href='genome_description?gid=<%= gid %>'><%= gid %></a></td>
            <td class='center' nowrap><a href='/taxa/tax_description?otid=<%= cdata[gid].otid %>'><%= taxidfullname %></a></td>
            <td class='col3' title='<%= cdata[gid].organism %>'><i><%= cdata[gid].organism %></i></td>
            <td class='col3' title='<%= cdata[gid].strain %>'><%= cdata[gid].strain %></td>
            <td class='center'><%= cdata[gid].contigs %></td>
            <td class='center'><%= cdata[gid].length.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); %></td>
            
            <td class="col1 center dropbtn" >
            <%= cdata[gid].crispr.length %>
            <% foundA = false %>
            <% for(let i = 0; i < cdata[gid].crispr.length; i++){ %>
               <% if(cdata[gid].crispr[i].prediction_cas == "Ambiguous"){ %>
                 <% foundA = true %>
               <% } %>
            <% } %>
            <% if(foundA){ %>
                 <small>A</small>
            <% } %>
            
           
             <span class="dd-menu">
                <button class=" pill pill-lg">Hover</button>
                <div class="dropdown-content">
             
                    <table class='hover-table'>
                    <tr>
                    <th class='hovercol1'>Contig</th>
                    <th class='hovercol1'>Operon</th>
                    <th class=''>Operon<br>Position</th>
                    <th class='hovercol9'>Prediction</th>
                    <th class='hovercol1'>CRISPRs</th>
                    <th class='hovercol9'>Distances</th>
                    <th class='hovercol6'>Prediction<br>Cas</th>
                    <th class='hovercol9'>Prediction<br>CRISPRs</th>
                    <th class='hovercol9'>Genome<br>Viewer</th>
                    
             
                    </tr>
                    
                <% for(let i = 0; i < cdata[gid].crispr.length; i++){ %>
                    <tr>
                    <% contig = cdata[gid].crispr[i].contig %>
                    <% p1 = cdata[gid].crispr[i].operon_pos[0] %>
                    <% p2 = cdata[gid].crispr[i].operon_pos[1] %>
                    <td class='center' title='<%= cdata[gid].crispr[i].contig %>'><%= contig %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].operon %>'><%= cdata[gid].crispr[i].operon %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].operon_pos %>'><%= cdata[gid].crispr[i].operon_pos %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].prediction %>'><%= cdata[gid].crispr[i].prediction %></td>
                    <td title='<%= cdata[gid].crispr[i].crisprs %>'>XX <%= cdata[gid].crispr[i].crisprs %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].distances %>'><%= cdata[gid].crispr[i].distances %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].prediction_cas %>'><%= cdata[gid].crispr[i].prediction_cas %></td>
                    <td class='center' title='<%= cdata[gid].crispr[i].prediction_crisprs %>'><%= cdata[gid].crispr[i].prediction_crisprs %></td>
                    
                    <% if(cdata[gid].crispr[i].prediction_cas == "Ambiguous"){ %>
                      <td></td>
                    <% }else{ %>
                      <% loc = contig+":"+(parseInt(p1)-500).toString()+".."+(parseInt(p2)+500).toString() %>
                      <% highlight = contig+":"+p1+".."+p2 %>
                      <td class='center'><a title='JBrowse/Genome Viewer' href='#' onclick="open_jbrowse('<%= gid %>','crispr','','','','<%= loc %>','<%= highlight %>')">open
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
                        </svg>
                      </a> </td>
                    <% } %>
                    
                    </tr>
                <% } %>
                    
                    </table>
             
           </div>
           </span>
           </td>
           <td class='center'>
             <a href="<%= cfg.HOMD_URL_BASE %><%= cfg.CRISPR_PATH %><%= gid %>/" target='_blank'>ftp
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
              </svg>
            </a>
          </td>
       </tr>
           
       <% } %>
       </tbody>
       </table>
       
       </div>
    


  
    </div> <!-- end: page-content -->
    
    <div id='footer'>
         <%- include('../../partials/footer'); %>
    </div>
       
</body>

</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/menu.js"></script>
<script type="text/javascript" src="/js/genomes.js"></script>
<script type="text/javascript" src="/js/sorttable.js"></script> <!-- https://www.kryogenix.org/code/browser/sorttable -->
<script>
  mainmenu()
  var jb_path = '<%- cfg.JBROWSE_URL %>'
  
  document.onreadystatechange = function() {
        // just three els to loader: this(js);css;html
        if (document.readyState !== "complete") {
            document.querySelector(
                '#crispr-table-div').style.visibility = "hidden";
            document.querySelector(
                "#loader").style.visibility = "visible";
        } else {
            document.querySelector(
                "#loader").style.display = "none";
            document.querySelector(
                '#crispr-table-div').style.visibility = "visible";
        }
  };
  
    
</script>


